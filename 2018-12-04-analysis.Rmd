---
title: "analysis"
author: "Joshua Rosenberg"
date: "9/13/2018"
html_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE, warning = FALSE)
```

## Loading, setting up

In this section, we start out by doing:

```{r, load-packages, message = FALSE}
library(tidyverse)
library(tidyLPA)
library(psych)
usethis::use_git_ignore("*.csv")
```

Read the data:

```{r, load-data, eval = TRUE}
d <- read_csv("tetcs-survey-export.csv", skip = 0)
df <- read_csv("full-tetcs-dataset.csv")

d <- d %>% slice(-c(1:2))
```

Check that the data loaded:

```{r, check-that-data-loaded}
d
```

Process the TETCs variables:

```{r}
ds <- d %>% 
    select(Q11_1:Q11_12) %>% 
    set_names(1:12) %>% 
    mutate_all(str_extract, "\\(?[0-9,.]+\\)?") %>% 
    mutate_all(as.integer) %>% 
    set_names(str_c("v", 1:12))
```

# Factor analysis

```{r}
parallel <- fa.parallel(ds, fm = 'minres', fa = 'fa')
parallel
```

There seems to be just one factor. 

# Latent Profile Analysis

```{r, eval = FALSE}

o <- ds %>% compare_solutions_mplus(v1:v12)

write_rds(o,"compare-solutions-mplus.rds")

x <- ds %>% 
    estimate_profiles_mplus(v1:v12, n_profiles = 3, variances = 'equal', covariances = 'zero')

write_rds(x, "x.rds")
```

```{r, eval = TRUE}
o <- read_rds("compare-solutions-mplus.rds")
x <- read_rds("x.rds")

o[[2]] %>% knitr::kable()
```

The fit statistics don't suggest a clear pattern. 

Perhaps a three profile solution:

```{r}
plot_profiles_mplus(x, to_center = TRUE)
```

There really seems to be groups only in terms of overall level of the twelve items; not any combinations of them variables in characteristic ways.

# Josh to run content area and grade level 

## Grade level

Proportion by grade level:

```{r}
df %>% 
    count(Q7_7)%>% 
    knitr::kable()
```

There are a number of others, see

```{r}
df %>% 
    select(Q7_7_TEXT) %>% 
    filter(!is.na(Q7_7_TEXT)) %>% 
    slice(1:25)%>% 
    knitr::kable()
```
 
Let's look at the counts of the main ones for now:

```{r}
df %>% 
    select(Q7_1:Q7_4) %>% 
    count(Q7_1, Q7_2,Q7_3, Q7_4) %>% 
    arrange(desc(n))%>% 
    knitr::kable()
```

This is quite messy but I think is instructive; how to process this is a bit tricky.

## Content area

There are a bunch of others:

```{r}
df %>%
    count(Q8_12)%>% 
    knitr::kable()
```

Some specifics:

```{r}
df %>% 
    select(Q8_12_TEXT) %>% 
    filter(!is.na(Q8_12_TEXT)) %>% 
    slice(1:25) %>% 
    knitr::kable()
```

```{r}
df %>%
    select(Q8_1:Q8_11) %>% 
    count( Q8_1,Q8_2,Q8_3,Q8_4, Q8_5,  Q8_6,  Q8_7, Q8_8, Q8_9 ,Q8_10,Q8_11) %>% 
    arrange(desc(n))%>% 
    knitr::kable()
```

A big mess, but perhaps instructive, still.