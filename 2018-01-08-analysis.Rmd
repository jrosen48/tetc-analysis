---
title: "analysis"
author: "Joshua Rosenberg"
date: "9/13/2018"
html_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, messages = FALSE, warning = FALSE)
```

# Update on qualitative coding

## Item #13 - Please explain the one or two technology competencies that you consider as being most important to your individual work as a teacher educator.

## Loading, setting up

In this section, we start out by doing:

```{r, load-packages, message = FALSE}
library(tidyverse)
library(tidyLPA)
library(psych)
usethis::use_git_ignore("*.csv")
```

Read the data:

```{r, load-data, eval = TRUE}
# d <- read_csv("tetcs-survey-export.csv", skip = 0)
d <- read_csv("full-tetcs-dataset.csv")
d <- d %>% slice(-c(1:2))
```

Joining data - this is to join the qualitative data (not run right now)

```{r, eval = FALSE}
library(googlesheets)
g <- gs_title("Teacher Education Technology Competencies Survey_November 12, 2018_20.32")
d2 <- gs_read(g, ws = 2, skip = 1)
d2 <- d2 %>% rename(Q13 = `Please explain the one or two technology competencies that you consider as being most important to your individual work as a teacher educator.`) %>% slice(-c(338:339))
d3 <- gs_read(g, ws = 3, skip = 1)
d3 <- d3 %>% rename(Q14 = `Please explain one or more of the technology competencies that you consider of low or no importance to your individual work as a teacher educator.`) %>% slice(-c(338:339))
d4 <- gs_read(g, ws = 4, skip = 1)
d4 <- d4 %>% rename(Q15 = `What is important in your work related to educational technology that is not reflected in the TETCs?`) %>% slice(-c(338:339))
```

```{r}
d2i <- read_csv("q13[1].csv")
d2ii <- d %>% inner_join(d2)
d2f <- rbind(d2ii, d2i)

d %>% 
    inner_join(d3)

d %>% 
    inner_join(d4) 
```

Check that the data loaded:

```{r, check-that-data-loaded}
d
```

Process the TETCs variables:

```{r}
ds <- d %>% 
    select(Q11_1:Q11_12) %>% 
    set_names(1:12) %>% 
    mutate_all(str_extract, "\\(?[0-9,.]+\\)?") %>% 
    mutate_all(as.integer) %>% 
    set_names(str_c("v", 1:12))
```

```{r}
dss <- ds %>% 
    gather(key, val) %>% 
    mutate(key = str_replace(key, "v", "TETC-"))

dss$key = with(dss, reorder(key, val, mean, na.rm = TRUE))

dss %>% 
    ggplot(aes(x = reorder(key, val), y = val)) +
    geom_violin() +
    # geom_jitter() +
    theme_bw() +
    ylab("Value") +
    xlab(NULL) +
    ylim(1, 5)
```

```{r}
library(ggridges)

dss <- ds %>% 
    gather(key, val) %>% 
    mutate(key = str_replace(key, "v", "TETC-"))

dss$key = with(dss, reorder(key, val, mean, na.rm = TRUE))

dss %>% 
    ggplot(aes(y = key, x = val)) +
    geom_density_ridges(scale = .9) +
    theme_bw() +
    ylab("Value") +
    xlab(NULL) +
    xlim(1, 5)
```

```{r}
ds %>% 
    gather(key, val) %>% 
    mutate(key = str_replace(key, "v", "TETC-")) %>% 
    group_by(key) %>% 
    summarize(mean_val = mean(val, na.rm = TRUE),
              sd_val = sd(val, na.rm = TRUE)) %>% 
    ggplot(aes(x = reorder(key, mean_val), y = mean_val)) +
    geom_col() +
    geom_errorbar(aes(ymin = mean_val-((2*sd_val)/sqrt(336)),
                      ymax = mean_val+((2*sd_val)/sqrt(336)))) +
    theme_bw() +
    ylab("Value") +
    xlab(NULL) +
    ylim(0, 5)

ggsave('tetc-plot.png', width = 8, height = 6)
```

# Factor analysis

```{r}
parallel <- fa.parallel(ds, fm = 'minres', fa = 'fa')
parallel
VSS.scree(ds)
```

There seems to be just one factor. Though, there could be a case for two.

```{r}
f1 <- fac(ds, nfactors = 1)
f2 <- fac(ds, nfactors = 2)
f3 <- fac(ds, nfactors = 3)
```

# Latent Profile Analysis

```{r, eval = FALSE}

o <- ds %>% compare_solutions_mplus(v1:v12)

write_rds(o,"compare-solutions-mplus.rds")

x <- ds %>% 
    estimate_profiles_mplus(v1:v12, n_profiles = 3, variances = 'equal', covariances = 'zero')

write_rds(x, "x.rds")
```

```{r, eval = TRUE}
o <- read_rds("compare-solutions-mplus.rds")
x <- read_rds("x.rds")

o[[2]] %>% knitr::kable()
```

The fit statistics don't suggest a clear pattern. 

Perhaps a three profile solution:

```{r}
plot_profiles_mplus(x, to_center = TRUE)
```

There really seems to be groups only in terms of overall level of the twelve items; not any combinations of them variables in characteristic ways.

# Josh to run content area and grade level 

## Grade level

Proportion by grade level:

```{r}
df %>% 
    count(Q7_7)%>% 
    knitr::kable()
```

There are a number of others, see

```{r}
df %>% 
    select(Q7_7_TEXT) %>% 
    filter(!is.na(Q7_7_TEXT)) %>% 
    slice(1:25)%>% 
    knitr::kable()
```

Let's look at the counts of the main ones for now:

```{r}
df %>% 
    select(Q7_1:Q7_4) %>% 
    count(Q7_1, Q7_2,Q7_3, Q7_4) %>% 
    arrange(desc(n))%>% 
    knitr::kable()
```

This is quite messy but I think is instructive; how to process this is a bit tricky.

## Content area

There are a bunch of others:

```{r}
df %>%
    count(Q8_12)%>% 
    knitr::kable()
```

Some specifics:

```{r}
df %>% 
    select(Q8_12_TEXT) %>% 
    filter(!is.na(Q8_12_TEXT)) %>% 
    slice(1:25) %>% 
    knitr::kable()
```

```{r}
df %>%
    select(Q8_1:Q8_11) %>% 
    count( Q8_1,Q8_2,Q8_3,Q8_4, Q8_5,  Q8_6,  Q8_7, Q8_8, Q8_9 ,Q8_10,Q8_11) %>% 
    arrange(desc(n))%>% 
    knitr::kable()
```

A big mess, but perhaps instructive, still.